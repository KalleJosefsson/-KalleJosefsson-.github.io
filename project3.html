<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Project 1: Morphing faces for fun</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f4f4f4;
            color: #333;
        }
        header {
            text-align: center;
            margin-bottom: 50px;
        }
        h1 {
            font-size: 2.5em;
            color: #4CAF50;
        }
        h2 {
            color: #4CAF50;
        }
        p {
            font-size: 1.2em;
            line-height: 1.6em;
        }
        img {
            max-width: 100%;
            height: auto;
            border-radius: 10px;
            margin: 20px 0;
        }
        section {
            margin-bottom: 40px;
        }
        footer {
            text-align: center;
            margin-top: 50px;
            font-size: 0.8em;
            color: #777;
        }
        .screenshot {
            display: flex;
            justify-content: center;
        }
    </style>
</head>
<body>
    <header>
        <h1> Overview of project </h1>
    </header>
  <section>
    <p>
      For project 3 we are supposed to do morphing between faces, change facial features and expressions. This is actually done quite easily by first just manually annotating corresponding points on faces.
      Then  triangulation of these points which is done using the Delaunay algorithm so that we get corresponing triangulation betweeen two different faces. After that we can do all sorts of cool stuff by just
      warping and cross disolving. By using affine transformations we warp faceshapes into other peoples shapes and by crossdissolving which is essentially linear interpolation of the colors we can create
      realistic blends of faces using more than jsut the shapes. Below I will go through the process step by step following the project tasks
    </p>
  </section>

    <header>
        <h2> Part 1: Coressponding points </h2>
    </header>
    <section>
        <p>
            For this task I used the program recommended for annotating correspodning points for two images, one of me and one of famous actor Leonardo DiCaprio. I chose 66 corresponding points on each face
            and then added 4 more corner points leading to a total of 70 points in each image. Below I present the triangulation of the corresponding points. Note that I tried to capture as many facial features
            with as few points as possible in order to get as good of a result possible with less computation time.
        </p>

         <div class="screenshot" style="display: flex; justify-content: space-between; align-items: flex-start; flex-wrap: wrap;">

        <div style="flex: 1; padding: 10px; min-width: 48%;">
            <img src="./images3/kalle_triangles.png" alt="Image before processing " style="max-width: 100%; border-radius: 8px;">
            <p>Triangulation of corressponding points on my face</p>
        </div>

        <!-- Second image: Original image for comparison -->
        <div style="flex: 1; padding: 10px; min-width: 48%;">
            <img src="./images3/leo_triangles.png" alt="Gradient Magnitude" style="max-width: 100%; border-radius: 8px;">
            <p>Triangulation of corressponding points on Leo's face</p>
        </div>
    </div>
    </section>

    <header>
        <h3> Part 2: Computing the halfway face </h3>
    </header>

    <section>
        <p>
            Now that I have the corresponding triangulations for each face the fun begins. The first thing I do is calculate the halfway face which is done by doing the follow. First we calculate the halfway keypoints
            by taking the average of my key points and Leo's keypoints. Then we again triangulate using our new halfway keypoints so that we get a new set of triangles. Then we warp my triangles into the corresponding 
            trinagles of the midway face as well as Leo's triangles. This is done by affine transformation which maps one trinagle into another, we calculate the transformation matrix , T, for transforming a source triangle, X, into a target triangle
            , y, by solving the linear system using numpy's function linalgsolve(x,y). This is done for each triangle in both the image of me and Leo, now we have warped our faces into the average between our faces. Now we want to
            change the color so that we get a good blend between not only the shapes, this is done by cross dissolving, take the average of the pixel values and adding them together. After normalization I got the following
            results.
        </p>

         <div class="screenshot" style="display: flex; justify-content: space-between; align-items: flex-start; flex-wrap: wrap;">

        <div style="flex: 1; padding: 10px; min-width: 48%;">
            <img src="./images3/kalle1.jpg" alt="Image before processing " style="max-width: 100%; border-radius: 8px;">
            <p> Original image of me</p>
        </div>

        <!-- Second image: Original image for comparison -->
        <div style="flex: 1; padding: 10px; min-width: 48%;">
            <img src="./images3/leo.jpg" alt="Gradient Magnitude" style="max-width: 100%; border-radius: 8px;">
            <p>Original image of Leo</p>
        </div>

     
    </div>
        <div class="screenshot" style="display: flex; justify-content: space-between; align-items: flex-start; flex-wrap: wrap;">

        <div style="flex: 1; padding: 10px; min-width: 48%;">
            <img src="./images3/midway_kalle.jpg" alt="Image before processing " style="max-width: 100%; border-radius: 8px;">
            <p>My face warped into the halfway shape</p>
        </div>

        <!-- Second image: Original image for comparison -->
        <div style="flex: 1; padding: 10px; min-width: 48%;">
            <img src="./images3/midway_leo.jpg" alt="Gradient Magnitude" style="max-width: 100%; border-radius: 8px;">
            <p>Leo's face warped into the halfway shape</p>
        </div>

        <div style="flex: 1; padding: 10px; min-width: 48%;">
            <img src="./images3/midway_blend.jpg" alt="Gradient Magnitude" style="max-width: 100%; border-radius: 8px;">
            <p>After cross dissolving, i.e averaging the two faces</p>
        </div>
    </div>
    </section>

    <header>
        <h4> Part 3: The morph sequence </h4>
    </header>

    <section>
        Now that we know how to create the halfway face we should also be able to create other fractions of blending. Well luckely it is the same exact process
        just instead of taking the average we use other fractions than 1/2. The task was to create a video which is a sequence of 46 images starting with the
        original image of one face and ending with the original image of the other face. I did this by doing to the same process as before but 46 times with 44 fractions
        evenely spanned between zero and one in order to get a clean smooth transition. What we do is we compute the source trinagles which is now calculated based
        on the fraction, q, as (q*kalle_triangles + (1-q)*leo_triangles). I warp both sets of triangles into this shape and then cross dissolve using the same fraction to get
        the morphed image for fraction q as (q*morphed_kalle + (1-q)*morphed_leo). I then stacked the images together and displayed them in a sequence with each frame being
        shown for 30 ms. The cool result is presented below.

         <div class="screenshot" style="display: flex; justify-content: space-between; align-items: flex-start; flex-wrap: wrap;">

        <div style="flex: 1; padding: 10px; min-width: 48%;">
            <img src="./images3/leo_to_kalle.gif" alt="Image before processing " style="max-width: 50%; border-radius: 8px;">
            <p>Triangulation of corressponding points on my face</p>
        </div>

        
    </div>
    </section>

    <header>
        <h5>Part 4: Calculating the mean face of the population and more</h5>
    </header>

    <section>
        Now that we have started to get warm we can do other cool stuff. The first thing being calculating the average face of danish people. I used
        the danish dataset that was recommended which was already anotated with corresponding points, however I added the 4 corner points because I liked the results
        more using them. Then I took the average of the corresponding points for both males and femlas creating the average faceshape for both males and females. After that
        I morphed each male and female into their correspending gender average shape. When this is done we can calculate the average face by cross dissolving the images
        this was done by just taking the mean of each pixel for the warped males and females. The results of the average faces are presented below as well as some exaples
        of males and females warped into the average shape.
        
    </section>
    <!-- Footer Section -->
    <footer>
        <p>Â© 2024 Kalle's Portfolio | Project 1: Aligning RGB Images</p>
        <p>Contact: <a href="mailto:kj00@berkeley.edu">kj00@berkeley.edu</a></p>
    </footer>
</body>
</html>
